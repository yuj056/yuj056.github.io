![alt text](https://github.com/yuj056/yuj056.github.io/blob/master/_posts/Screen%20Shot%202018-06-12%20at%2010.51.39%20AM.png)
# Second period of work
## 1. The work done in the first period
First let's quickly review what I implemented in the first period of work. The governing equations and algebraic constraints are derived for the 1D plug flow with surface chemistry. SiF4 and NH3 isothermal reactions are used to varify the computational model, where nonlinear equation solver and IDA solver are used to calculate the initial values at the entrance of the tube and determine the variables vary along the the flow direction, respectively. The problem I stuck last time is that the IDA solver cannot be convergent.
## 2. Trouble shooting
Therefore, the goal for this period of work is obvious that I need to figure out the reasons lead to the solver divergent. After the Skype call with my mentors to discuss the problem in my code at the beginning of the second period of work, I was suggested that: 1. use a one step adsorption reaction to check the IDA solver 2. do not use `advance_to_coverage` to calculate the site fraction inside the residual function, solving the trasient site fraction equation and getting the steady state site fraction inside the residual function instead. Meanwhile, use the `gas.set_unnormalized_mass_fractions` and `interface.set_unnormalized_coverages`to block the functions of these syntax since the normalized mass fractions and coverages will bring in more algebraic constraints and affect the results.
### 2.1 One step  adsorption reaction
H2O (g) + O (s) = H2O (s) is selected as our one step adsorption mechanism to do the further simulation, where H2O (g) represents the gas phase water (know as water vapor), the O (s) means the empty site in the surface and the H2O (s) stands for the adsorped water as a surface species. After determining the short mechanism, a cti file for the reaction need to be created as the input file of cantera.interface and cantera.gas. The [cti file](https://github.com/yuj056/yuj056.github.io/blob/master/model/small_mec.cti) is shown as follows:
![alt text](https://github.com/yuj056/yuj056.github.io/blob/master/_posts/cti.png)
## 2.2 Use IDA solver to calculate transient site fraction equation
Since the heterogeneous production rates for gas species g<sub>k</sub> need to be determined based on the composition of surface and gas , we first need to calculate the site fraction in each location of the tube at steady state. The following differential equation and algebraic constraints are used:
![alt text](https://github.com/yuj056/yuj056.github.io/blob/master/_posts/eq.png)
where the s<sub>k</sub> is the net molar production rate of surface species, &sigma;<sub>k</sub> represents the site occupancy number of each species and &Gamma; means the total site density.
The initial conditions at the entrance of the tube are applied to check the performance of the IDA solver. A residual function was constructed putting all the terms into the LHS of the equations. When calling the `scikits.odes.dae solver`, integrator name 'IDA' should be selected, the residual function, tolerance and the algebraic constraints indices are the important parameters for the solver to solve the DAE (Differential and Algebraic) system. In the results, we can see that the site fractions of the surface species agree well with the results from `surface.advance_to_coverage`, furthermore the net production rates of surface species go zero at steady states which indicates the IDA solver works great to calculate the transient site fraction equation.
![alt text](https://github.com/yuj056/yuj056.github.io/blob/master/zk.png)
## 2.3 Insert the site fraction DAE solver into the whole governing DAE system 
At each location of the tube, the heterogeneous net production rate (g<sub>k</sub>) of the gas species should be determined. g<sub>k</sub> can be obtained by marching the site fraction with time when the net production rates of surface species(s<sub>k</sub>) go zeros, then g<sub>k</sub> is recorded at the specific time. Other variables u, &rho;, p, Y<sub>k</sub> are varing with the flow direction which can be determined by the whole conservation DAE system. IDA solver is applied again to calculate these variables. For the IDA solver, the initial condition of the vector of the variables and the vector of the prime of the variables at the entrance of the tube need to be provided. Here, we use the nonlinear ODE solver to calculate the initial values. The trouble I met right now is `Invalid input detected`, I read the [source code of the IDA solver](https://github.com/bmcage/odes/blob/master/scikits/odes/sundials/ida.pyx), this specific error can be from the tstep, tolerance, y_retn, yp_retn and other factors. I tested the two residual functions by using IDA solver separately, both of them work fine. The problem is when insert one residual function into the other, problem occurs. I am still working on this part. The code can be found in this [link]()
# 3. Future work
* Fix the solver erorr, making the model of one step reaction kinetic mechanism works.
* Apply the model to the more complex SiF4 and NH3 reaction kinetic mechanism, getting the computational results consistent with the ones of Sundial paper.
* Integrate my code to the Cantera source code
The model is almost there, I will work harder to make more progress in the final stage. Thanks again for my mentors help to supervise my work. See you guys in my next blog!


